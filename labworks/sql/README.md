# Лабораторная работа № 1. SQL

---

## Содержание:

* [Краткая теория и терминология](#краткая-теория-и-терминология)
* [Описание учебного примера](#описание-учебного-примера)
* [Задание](#задание)

---

## Краткая теория и терминология

__SQL__ (Structured Query Language) - это декларативный язык программирования (язык запросов), который используют для
создания, обработки и хранения данных в реляционных базах данных.

SQL позволяет:

* получать доступ к данным в системах управления реляционными базами данных;
* описывать данные (их структуру);
* определять данные в базе данных и управлять ими;
* взаимодействовать с другими языками через модули SQL, библиотеки и предваритальные компиляторы;
* создавать и удалять БД и таблицы;
* создавать представления, хранимые процедуры (stored procedures) и функции в БД;
* устанавливать разрешения на доступ к таблицам, процедурам и представлениям.

[Видео-туториал по SQL](https://youtu.be/HXV3zeQKqGY?si=mnaZUEzn7QtrrgPI).

__PostgreSQL__ - СУБД с открытым исходным кодом, основой которого был код, написанный в Беркли. Она поддерживает большую
часть стандарта SQL и предлагает множество современных функций:

* сложные запросы;
* внешние ключи;
* триггеры;
* изменяемые представления;
* транзакционная целостность;
* многоверсионность.

[Официальная документация по PostgreSQL на русском языке](https://postgrespro.ru/docs/postgresql/13/index).

__ORM__ (Object-Relational Mapping) - технология программирования, которая связывает базы данных с концепциями
объектно-ориентированных языков программирования, создавая «виртуальную объектную базу данных». На языке Python самой
популярной ORM является [SQLAlchemy](https://www.sqlalchemy.org/). Среди преимоществ ее использования можно выделить:

* Безопасность. Параметры запросов экранируются, что делает атаки типа внедрение SQL-кода маловероятными.
* Производительность. Повышается вероятность повторного использования запроса к серверу базы данных, что может
  позволить ему в некоторых случаях применить повторно план выполнения запроса.
* Переносимость. SQLAlchemy, при должном подходе, позволяет писать код на Python, совместимый с несколькими back-end
  СУБД. Несмотря на стандартизацию языка SQL, между базами данных имеются различия в его реализации, абстрагироваться от
  которых и помогает SQLAlchemy.

---

## Описание учебного примера

В директории `data` находятся данные из набора `Movielens`, содержащий информацию о фильмах и оценках пользователей.
Данный набор данных содержит 4 таблицы:

* __movies__: записи о фильмах ([movies.csv](./data/records/movies.csv)):
    * id - идентификатор фильма;
    * title - название фильма;
    * genre - жанры фильма.
* __movie_imdb__: таблица, сопоставляющая идентификатор фильма с идентификатором в IMDB и
  TMDB ([links.csv](./data/records/links.csv)):
    * id - идентификатор записи;
    * movie_id - внешний ключ на id фильма;
    * imdb_id - идентификатор IMDB;
    * tmdb_id - идентификатор TMDB.
* __user_movie_rating__: таблица, содержащая оценки от пользователей для
  фильмов ([ratings.csv](./data/records/ratings.csv)):
    * id - идентификатор записи;
    * movie_id - внешний ключ на id фильма;
    * user_id - идентификатор пользователя;
    * rating - оценка фильму;
    * timestamp - количество секунд, начиная с полночи 1 января 1970 (UTC формат).
* __user_movie_tag__: таблица, содержащая пользовательские теги к фильму ([tags.csv](./data/records/tags.csv)):
    * id - идентификатор записи;
    * movie_id - внешний ключ на id фильма;
    * user_id - идентификатор пользователя;
    * tag - пользовательский тег;
    * timestamp - количество секунд, начиная с полночи 1 января 1970 (UTC формат).

[init.sql](./data/init.sql) содержит SQL-скрипт, который создает и заполняет таблицы.

Для разворачивания лабораторной работы, необходимо в текущей директории отркыть командную строку и выполнить команду:

```bash
docker compose up --build
```

Примеры запросов и задания находятся в файле [task.ipynb](task.ipynb).

---

## Задание

0. Изучите учебные материалы.
1. Выполните задания в `task.ipynb` с использованием ORM SQLAlchemy или на чистом SQL с помощью psycopg.

Дополнительное задание:

3. Постарайтесь оценить и оптимизировать свои запросы (желательно с комментариями в ячейке Markdown).

---
